@{
    ViewData["Title"] = "Müşteri Yönetimi";
}

<div class="container-fluid">
    <!-- Page Header -->
    <div class="page-header fade-in">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="display-4 fw-bold mb-2">
                    <i class="fas fa-users me-3 text-primary"></i>
                    Müşteri Yönetimi
                </h1>
                <p class="page-subtitle lead mb-0">
                    Müşteri ilişkilerinizi, iletişim bilgilerini ve iş detaylarını yönetin
                </p>
            </div>
            <div class="col-md-4 text-md-end">
                <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#createAccountModal">
                    <i class="fas fa-user-plus me-2"></i>Yeni Müşteri Ekle
                </button>
            </div>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <!-- Search and Filter Section -->
    <div class="search-filter-section">
        <div class="row g-3 align-items-end">
            <div class="col-md-4">
                <label for="searchInput" class="form-label">
                    <i class="fas fa-search me-2"></i>Müşteri Ara
                </label>
                <div class="input-group">
                    <input type="text" class="form-control" id="searchInput" placeholder="Şirket adı, iletişim kişisi veya e-posta ile ara...">
                    <button class="btn btn-outline-secondary" type="button" id="searchBtn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            <div class="col-md-3">
                <label for="statusFilter" class="form-label">
                    <i class="fas fa-filter me-2"></i>Durum Filtresi
                </label>
                <select class="form-select" id="statusFilter">
                    <option value="">Tüm Durumlar</option>
                    <option value="true">Aktif</option>
                    <option value="false">Pasif</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="sortBy" class="form-label">
                    <i class="fas fa-sort me-2"></i>Sırala
                </label>
                <select class="form-select" id="sortBy">
                    <option value="companyName">Şirket Adı</option>
                    <option value="createdDate">Oluşturulma Tarihi</option>
                    <option value="contactPerson">İletişim Kişisi</option>
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-outline-primary w-100" id="clearFilters">
                    <i class="fas fa-times me-2"></i>Temizle
                </button>
            </div>
        </div>
    </div>

    <!-- Clients Table -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h3 class="card-title mb-0">
                <i class="fas fa-table me-2 text-primary"></i>
                Müşteri Listesi
            </h3>
            <div class="header-actions">
                <button class="btn btn-outline-secondary btn-sm me-2" id="refreshBtn">
                    <i class="fas fa-sync-alt me-1"></i>Yenile
                </button>
                <button class="btn btn-outline-success btn-sm" id="exportClientsBtn">
                    <i class="fas fa-download me-1"></i>Dışa Aktar
                </button>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table id="accountsTable" class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>
                                <i class="fas fa-building me-2"></i>Şirket Adı
                            </th>
                            <th>
                                <i class="fas fa-user me-2"></i>İletişim Kişisi
                            </th>
                            <th>
                                <i class="fas fa-envelope me-2"></i>E-posta
                            </th>
                            <th>
                                <i class="fas fa-phone me-2"></i>Telefon
                            </th>
                            <th>
                                <i class="fas fa-map-marker-alt me-2"></i>Vergi Dairesi
                            </th>
                            <th>
                                <i class="fas fa-info-circle me-2"></i>Durum
                            </th>
                            <th class="text-center">
                                <i class="fas fa-cogs me-2"></i>İşlemler
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be loaded via AJAX -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        <span id="showingCount">0</span> / <span id="totalCount">0</span> müşteri gösteriliyor
                    </small>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-primary" id="prevPage">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button type="button" class="btn btn-outline-primary" id="nextPage">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="empty-state" style="display: none;">
        <i class="fas fa-users"></i>
        <h3>Müşteri Bulunamadı</h3>
        <p>İlk müşterinizi ekleyerek başlayın</p>
        <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#createAccountModal">
            <i class="fas fa-user-plus me-2"></i>İlk Müşteriyi Ekle
        </button>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner" style="display: none;">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Yükleniyor...</span>
        </div>
    </div>
</div>

<!-- Create Account Modal -->
<div class="modal fade" id="createAccountModal" tabindex="-1" aria-labelledby="createAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createAccountModalLabel">
                    <i class="fas fa-user-plus me-2 text-primary"></i>
                    Yeni Müşteri Ekle
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>
            <form id="createAccountForm">
                <div class="modal-body">
                    @Html.AntiForgeryToken()
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="CompanyName" class="form-label fw-bold">
                                    <i class="fas fa-building me-2 text-primary"></i>Şirket Adı *
                                </label>
                                <input type="text" class="form-control" id="CompanyName" name="CompanyName" required 
                                       placeholder="Şirket adını girin...">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="ContactPerson" class="form-label fw-bold">
                                    <i class="fas fa-user me-2 text-success"></i>İletişim Kişisi
                                </label>
                                <input type="text" class="form-control" id="ContactPerson" name="ContactPerson" 
                                       placeholder="İletişim kişisi adını girin...">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="Email" class="form-label fw-bold">
                                    <i class="fas fa-envelope me-2 text-info"></i>E-posta *
                                </label>
                                <input type="email" class="form-control" id="Email" name="Email" required 
                                       placeholder="E-posta adresini girin...">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="PhoneNumber" class="form-label fw-bold">
                                    <i class="fas fa-phone me-2 text-warning"></i>Telefon Numarası
                                </label>
                                <input type="tel" class="form-control" id="PhoneNumber" name="PhoneNumber" 
                                       placeholder="Telefon numarasını girin...">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="TaxOffice" class="form-label fw-bold">
                                    <i class="fas fa-map-marker-alt me-2 text-secondary"></i>Vergi Dairesi
                                </label>
                                <input type="text" class="form-control" id="TaxOffice" name="TaxOffice" 
                                       placeholder="Vergi dairesini girin...">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="TaxNumber" class="form-label fw-bold">
                                    <i class="fas fa-hashtag me-2 text-dark"></i>Vergi Numarası
                                </label>
                                <input type="text" class="form-control" id="TaxNumber" name="TaxNumber" 
                                       placeholder="Vergi numarasını girin...">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="IsActive" name="IsActive" checked>
                                <label class="form-check-label fw-bold" for="IsActive">
                                    <i class="fas fa-check-circle me-2 text-success"></i>Aktif Hesap
                                </label>
                                <div class="form-text">
                                    <i class="fas fa-lightbulb me-1"></i>
                                    Aktif müşteriler yeni teklifler için seçilebilir
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>İptal
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Müşteri Oluştur
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Account Modal -->
<div class="modal fade" id="editAccountModal" tabindex="-1" aria-labelledby="editAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editAccountModalLabel">
                    <i class="fas fa-edit me-2 text-warning"></i>
                    Müşteriyi Düzenle
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>
            <form id="editAccountForm">
                <div class="modal-body">
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="EditId" name="Id">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="EditCompanyName" class="form-label fw-bold">
                                    <i class="fas fa-building me-2 text-primary"></i>Şirket Adı *
                                </label>
                                <input type="text" class="form-control" id="EditCompanyName" name="CompanyName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="EditContactPerson" class="form-label fw-bold">
                                    <i class="fas fa-user me-2 text-success"></i>İletişim Kişisi
                                </label>
                                <input type="text" class="form-control" id="EditContactPerson" name="ContactPerson">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="EditEmail" class="form-label fw-bold">
                                    <i class="fas fa-envelope me-2 text-info"></i>E-posta *
                                </label>
                                <input type="email" class="form-control" id="EditEmail" name="Email" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="EditPhoneNumber" class="form-label fw-bold">
                                    <i class="fas fa-phone me-2 text-warning"></i>Telefon Numarası
                                </label>
                                <input type="tel" class="form-control" id="EditPhoneNumber" name="PhoneNumber">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="EditTaxOffice" class="form-label fw-bold">
                                    <i class="fas fa-map-marker-alt me-2 text-secondary"></i>Vergi Dairesi
                                </label>
                                <input type="text" class="form-control" id="EditTaxOffice" name="TaxOffice">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="EditTaxNumber" class="form-label fw-bold">
                                    <i class="fas fa-hashtag me-2 text-dark"></i>Vergi Numarası
                                </label>
                                <input type="text" class="form-control" id="EditTaxNumber" name="TaxNumber">
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="EditIsActive" name="IsActive">
                                <label class="form-check-label fw-bold" for="EditIsActive">
                                    <i class="fas fa-check-circle me-2 text-success"></i>Aktif Hesap
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>İptal
                    </button>
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-save me-2"></i>Müşteriyi Güncelle
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Account Details Modal -->
<div class="modal fade" id="accountDetailsModal" tabindex="-1" aria-labelledby="accountDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="accountDetailsModalLabel">
                    <i class="fas fa-info-circle me-2 text-info"></i>
                    Müşteri Detayları
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 fw-bold">Şirket Adı:</dt>
                            <dd class="col-sm-8" id="DetailsCompanyName"></dd>
                            
                            <dt class="col-sm-4 fw-bold">İletişim Kişisi:</dt>
                            <dd class="col-sm-8" id="DetailsContactPerson"></dd>
                            
                            <dt class="col-sm-4 fw-bold">E-posta:</dt>
                            <dd class="col-sm-8" id="DetailsEmail"></dd>
                            
                            <dt class="col-sm-4 fw-bold">Telefon:</dt>
                            <dd class="col-sm-8" id="DetailsPhoneNumber"></dd>
                        </dl>
                    </div>
                    <div class="col-md-6">
                        <dl class="row">
                            <dt class="col-sm-4 fw-bold">Vergi Dairesi:</dt>
                            <dd class="col-sm-8" id="DetailsTaxOffice"></dd>
                            
                            <dt class="col-sm-4 fw-bold">Vergi Numarası:</dt>
                            <dd class="col-sm-8" id="DetailsTaxNumber"></dd>
                            
                            <dt class="col-sm-4 fw-bold">Durum:</dt>
                            <dd class="col-sm-8" id="DetailsIsActive"></dd>
                            
                            <dt class="col-sm-4 fw-bold">Oluşturulma Tarihi:</dt>
                            <dd class="col-sm-8" id="DetailsCreatedDate"></dd>
                        </dl>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Kapat
                </button>
                <button type="button" class="btn btn-primary" id="editFromDetails">
                    <i class="fas fa-edit me-2"></i>Müşteriyi Düzenle
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Silme Onayı
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>
            <div class="modal-body">
                <p class="mb-0">
                    Bu müşteriyi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz ve ilişkili teklifleri etkileyecektir.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>İptal
                </button>
                <button type="button" class="btn btn-danger" id="confirmDelete">
                    <i class="fas fa-trash me-2"></i>Müşteriyi Sil
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/accounts.js"></script>
}
